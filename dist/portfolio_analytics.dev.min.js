/*! portfolio_analytics - v0.0.3 (2016-10-06), Roman Rubsamen <roman.rubsamen@gmail.com> */var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.sum_=function(b){a.assertNumberArray_(b);var c=b.length,d=0,e=c%4;if(0!=e)for(var f=0;f<e;f++)d+=b[f];if(c<4)return d;for(var f=e;f<c;f+=4)d+=b[f]+b[f+1]+(b[f+2]+b[f+3]);return d},a.dot_=function(b,c){if(a.assertNumberArray_(b),a.assertNumberArray_(c),b.length!=c.length)throw new Error("input arrays must have the same length");var d=b.length,e=0,f=d%4;if(0!=f)for(var g=0;g<f;g++)e+=b[g]*c[g];if(d<4)return e;for(var g=f;g<d;g+=4)e+=b[g]*c[g]+b[g+1]*c[g+1]+(b[g+2]*c[g+2]+b[g+3]*c[g+3]);return e},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){function b(a,b,c){for(var d=-(1/0),e=-(1/0),f=-1,g=-1,h=-1,i=b;i<c+1;++i){a[i]>d&&(d=a[i],f=i);var j=(d-a[i])/d;j>e&&(e=j,g=f,h=i)}return[e,g,h]}return a.maxDrawdown_=function(a,c,d){return b(a,c,d)},a.maxDrawdown=function(c){a.assertPositiveNumberArray_(c);var d=b(c,0,c.length-1);return d[0]==-(1/0)?0:d[0]},a.drawdownFunction=function(b){var c=-(1/0);a.assertPositiveNumberArray_(b);for(var d=new b.constructor(b.length),e=0;e<b.length;++e)b[e]>c&&(c=b[e]),d[e]=(c-b[e])/c;return d},a.topDrawdowns=function(c,d){if(a.assertPositiveNumberArray_(c),a.assertPositiveInteger_(d),0==d)return[];var e=[],f=[];for(f.push([0,c.length-1,d]);0!=f.length;){var g=f.pop(),h=g[0],i=g[1],j=g[2],k=b(c,h,i),l=k[1],m=k[2],n=k[0];0!=n&&n!=-(1/0)&&e.push([n,l,m]),1==j||l==h&&m==i||(l==h&&m<i?f.push([m,i,j-1]):l>h&&m==i?f.push([h,l,j-1]):(f.push([h,l,j-1]),f.push([m,i,j-1])))}return e.sort(function(a,b){var c=a[0],d=b[0];if(c<d)return 1;if(c>d)return-1;var e=a[1],f=b[1];return e<f?-1:1}),e.slice(0,Math.min(d,e.length))},a.ulcerIndex=function(b){var c=a.drawdownFunction(b),d=a.dot_(c,c);return Math.sqrt(d/c.length)},a.painIndex=function(b){var c=a.drawdownFunction(b);return a.mean_(c)},a.conditionalDrawdown=function(b,c){a.assertBoundedNumber_(c,0,1);var d=a.drawdownFunction(b).slice(1);if(d.sort(function(a,b){return a-b}),1==c)return d[d.length-1];for(var e=1;c>e/d.length;)++e;var f=d[e-1],g=e/d.length,h=(g-c)*f,i=0;e<d.length&&(i=a.sum_(d.slice(e))/d.length);var j=(h+i)/(1-c);return j},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.gainToPainRatio=function(b){var c=a.arithmeticReturns(b).slice(1);if(0==c.length)return NaN;var d=a.mean_(c),e=a.lpm_(c,1,0);return 0==e?NaN:d/e},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.sharpeRatio=function(b,c){var d=a.arithmeticReturns(b).slice(1),e=a.arithmeticReturns(c).slice(1);if(0==d.length||0==e.length)return NaN;if("function"==typeof Float64Array)var f=new Float64Array(d.length);else var f=new Array(d.length);for(var g=0;g<d.length;++g)f[g]=d[g]-e[g];return a.sharpeRatio_(f)},a.sharpeRatio_=function(b){var c=a.mean_(b),d=a.sampleStddev_(b);return 0==d?NaN:c/d},a.biasAdjustedSharpeRatio=function(b,c){var d=a.arithmeticReturns(b).slice(1),e=a.arithmeticReturns(c).slice(1);if(0==d.length||0==e.length)return NaN;if("function"==typeof Float64Array)var f=new Float64Array(d.length);else var f=new Array(d.length);for(var g=0;g<d.length;++g)f[g]=d[g]-e[g];var h=a.sharpeRatio_(f),i=1+.25*(a.sampleKurtosis_(f)-1)/d.length;return h/i},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.cumulativeReturn=function(b){a.assertPositiveNumberArray_(b);var c=NaN;return b.length>=2&&(c=(b[b.length-1]-b[0])/b[0]),c},a.cagr=function(b,c){function d(a){var b=new Date(a);return b.setMinutes(b.getMinutes()-b.getTimezoneOffset()),b}a.assertPositiveNumberArray_(b),a.assertDateArray_(c),a.assertSameLengthArrays_(b,c);var e=b[0],f=c[0],g=b[b.length-1],h=c[c.length-1],i=864e5,j=(d(h)-d(f))/i,k=j/365.25,l=Math.pow(g/e,1/k)-1;return l},a.arithmeticReturns=function(b){a.assertPositiveNumberArray_(b);var c=new b.constructor(b.length);c[0]=NaN;for(var d=1;d<b.length;++d)c[d]=(b[d]-b[d-1])/b[d-1];return c},a.valueAtRisk=function(b,c){a.assertBoundedNumber_(c,0,1);var d=a.arithmeticReturns(b).slice(1);return d.sort(function(a,b){return a-b}),w=Math.floor(c*d.length),0==w?NaN:(valAtRisk=-d[w-1],valAtRisk)},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.hpm_=function(b,c,d){a.assertNumberArray_(b),a.assertPositiveInteger_(c);for(var e=b.length,f=0,g=0,h=0;h<e;++h)g+=Math.pow(Math.max(0,b[h]-d),c);f=g/e;for(var i=0,h=0;h<e;++h)i+=Math.pow(Math.max(0,b[h]-d),c)-f;return(g+i)/e},a.lpm_=function(b,c,d){a.assertNumberArray_(b),a.assertPositiveInteger_(c);for(var e=b.length,f=0,g=0,h=0;h<e;++h)g+=Math.pow(Math.max(0,d-b[h]),c);f=g/e;for(var i=0,h=0;h<e;++h)i+=Math.pow(Math.max(0,d-b[h]),c)-f;return(g+i)/e},a.mean_=function(b){a.assertNumberArray_(b);for(var c=b.length,d=0,e=0,f=0;f<c;++f)e+=b[f];d=e/c;for(var g=0,f=0;f<c;++f)g+=b[f]-d;return(e+g)/c},a.variance_=function(b){if(a.assertNumberArray_(b),1==b.length)return NaN;for(var c=b.length,d=a.mean_(b),e=0,f=0,g=0;g<c;++g){var h=b[g]-d;e+=h*h,f+=h}var i=e-f*f/c;return i/c},a.sampleVariance_=function(b){var c=a.variance_(b),d=b.length;return c*d/(d-1)},a.stddev_=function(b){return Math.sqrt(a.variance_(b))},a.sampleStddev_=function(b){return Math.sqrt(a.sampleVariance_(b))},a.skewness_=function(b){if(a.assertNumberArray_(b),b.length<=2)return NaN;for(var c=b.length,d=a.mean_(b),e=0,f=0,g=0,h=0;h<c;++h){var i=b[h]-d,j=i*i;e+=i*j,f+=j,g+=i}var k=g*g,l=e-2*g*f/c+2*k*g/(c*c),m=(f-k/c)/c;return 0==m?NaN:l/(c*Math.sqrt(m)*m)},a.sampleSkewness_=function(b){var c=a.skewness_(b),d=b.length;return c*Math.sqrt(d*(d-1))/(d-2)},a.kurtosis_=function(b){if(a.assertNumberArray_(b),b.length<=3)return NaN;for(var c=b.length,d=a.mean_(b),e=0,f=0,g=0,h=0,i=0;i<c;++i){var j=b[i]-d,k=j*j;e+=k*k,f+=j*k,g+=k,h+=j}var l=c*c,m=h*h,n=e-4*h*f/c+6*m*g/l-3*m*m/(l*c),o=(g-m/c)/c;return 0==o?NaN:n/(c*o*o)},a.sampleKurtosis_=function(b){var c=a.kurtosis_(b),d=b.length;return(d-1)/((d-2)*(d-3))*((d+1)*c-3*(d-1))+3},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.assertArray_=function(a){if(Object.prototype.toString.call(a).indexOf("Array")==-1)throw new Error("input must be an array")},a.assertNumberArray_=function(b){try{a.assertArray_(b)}catch(c){throw new Error("input must be an array of numbers")}if(0==b.length)throw new Error("input must be an array of numbers");for(var d=0;d<b.length;++d)try{a.assertNumber_(b[d])}catch(c){throw new Error("input must be an array of numbers")}},a.assertPositiveNumberArray_=function(b){try{a.assertArray_(b)}catch(c){throw new Error("input must be an array of positive numbers")}if(0==b.length)throw new Error("input must be an array of positive numbers");for(var d=0;d<b.length;++d)try{a.assertPositiveNumber_(b[d])}catch(c){throw new Error("input must be an array of positive numbers")}},a.assertNumber_=function(a){if("[object Number]"!=Object.prototype.toString.call(a)||isNaN(a)||a===1/0||a===-(1/0))throw new Error("input must be a number")},a.assertPositiveNumber_=function(b){try{a.assertNumber_(b)}catch(c){throw new Error("input must be a positive number")}if(b<0)throw new Error("input must be a positive number")},a.assertBoundedNumber_=function(b,c,d){try{a.assertNumber_(b),a.assertNumber_(c),a.assertNumber_(d)}catch(e){throw new Error("input(s) must be a number")}if(b<c||b>d)throw new Error("input must be bounded between "+c+" and "+d)},a.assertPositiveInteger_=function(b){try{a.assertPositiveNumber_(b)}catch(c){throw new Error("input must be a positive integer")}if(Math.floor(b)!==b)throw new Error("input must be a positive integer")},a.assertString_=function(a){if(!("string"==typeof a||a instanceof String))throw new Error("input must be a string")},a.assertStringEnumeration_=function(b,c){try{a.assertArray_(c)}catch(d){throw new Error("input must be an array of strings")}for(var e=0;e<c.length;++e)try{a.assertString_(c[e])}catch(d){throw new Error("input must be an array of strings")}try{a.assertString_(b)}catch(d){throw new Error("input must be a string equals to any of "+c.toString())}if(c.indexOf(b)==-1)throw new Error("input must be a string equals to any of "+c.toString())},a.assertDate_=function(a){if(!(a instanceof Date)||isNaN(a.getTime()))throw new Error("input must be a date")},a.assertDateArray_=function(b){try{a.assertArray_(b)}catch(c){throw new Error("input must be an array of dates")}if(0==b.length)throw new Error("input must be an array of dates");for(var d=0;d<b.length;++d)try{a.assertDate_(b[d])}catch(c){throw new Error("input must be an array of dates")}},a.assertSameLengthArrays_=function(b,c){try{a.assertArray_(b),a.assertArray_(c)}catch(d){throw new Error("input must be arrays of same length")}if(b.length!=c.length)throw new Error("input must be arrays of same length")},a}(PortfolioAnalytics||{});