/*! portfolio_analytics - v0.0.3 (2016-10-06), Roman Rubsamen <roman.rubsamen@gmail.com> */var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){function b(a,b,c){for(var d=-(1/0),e=-(1/0),f=-1,g=-1,h=-1,i=b;i<c+1;++i){a[i]>d&&(d=a[i],f=i);var j=(d-a[i])/d;j>e&&(e=j,g=f,h=i)}return[e,g,h]}return a.maxDrawdown_=function(a,c,d){return b(a,c,d)},a.maxDrawdown=function(c){a.assertPositiveNumberArray_(c);var d=b(c,0,c.length-1);return d[0]==-(1/0)?0:d[0]},a.drawdownFunction=function(b){var c=-(1/0);a.assertPositiveNumberArray_(b);for(var d=new b.constructor(b.length),e=0;e<b.length;++e)b[e]>c&&(c=b[e]),d[e]=(c-b[e])/c;return d},a.topDrawdowns=function(c,d){if(a.assertPositiveNumberArray_(c),a.assertPositiveInteger_(d),0==d)return[];var e=[],f=[];for(f.push([0,c.length-1,d]);0!=f.length;){var g=f.pop(),h=g[0],i=g[1],j=g[2],k=b(c,h,i),l=k[1],m=k[2],n=k[0];0!=n&&n!=-(1/0)&&e.push([n,l,m]),1==j||l==h&&m==i||(l==h&&m<i?f.push([m,i,j-1]):l>h&&m==i?f.push([h,l,j-1]):(f.push([h,l,j-1]),f.push([m,i,j-1])))}return e.sort(function(a,b){var c=a[0],d=b[0];if(c<d)return 1;if(c>d)return-1;var e=a[1],f=b[1];return e<f?-1:1}),e.slice(0,Math.min(d,e.length))},a.ulcerIndex=function(b){for(var c=a.drawdownFunction(b),d=0,e=0;e<c.length;++e)d+=c[e]*c[e];return Math.sqrt(d/c.length)},a.painIndex=function(b){var c=a.drawdownFunction(b);return a.mean_(c)},a.conditionalDrawdown=function(b,c){a.assertBoundedNumber_(c,0,1);var d=a.drawdownFunction(b).slice(1);if(d.sort(function(a,b){return a-b}),1==c)return d[d.length-1];for(var e=1;c>e/d.length;)++e;for(var f=d[e-1],g=e/d.length,h=(g-c)*f,i=0,j=e;j<d.length;++j)i+=d[j];i/=d.length;var k=(h+i)/(1-c);return k},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.gainToPainRatio=function(b){var c=a.arithmeticReturns(b).slice(1);if(0==c.length)return NaN;var d=a.mean_(c),e=a.lpm_(c,1,0);return 0==e?NaN:d/e},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){function b(a,b){return 0==b?NaN:a/b}function c(b,c){var d=a.arithmeticReturns(b).slice(1),e=a.arithmeticReturns(c).slice(1);if(0==d.length||0==e.length)return NaN;for(var f=new d.constructor(d.length),g=0;g<d.length;++g)f[g]=d[g]-e[g];return f}function d(a,b,c,d){return(1+.25*b*b*(d-1)-b*c)/(a-1)}return a.sharpeRatio_=function(a,c){return b(a,c)},a.sharpeRatio=function(d,e){var f=c(d,e),g=a.mean_(f),h=a.sampleStddev_(f);return b(g,h)},a.biasAdjustedSharpeRatio=function(d,e){var f=c(d,e),g=a.mean_(f),h=a.sampleStddev_(f),i=b(g,h),j=a.sampleKurtosis_(f),k=1+.25*(j-1)/f.length;return i/k},a.doubleSharpeRatio=function(e,f){var g=c(e,f),h=a.mean_(g),i=a.sampleStddev_(g),j=b(h,i),k=a.sampleSkewness_(g),l=a.sampleKurtosis_(g),m=Math.sqrt(d(g.length,j,k,l));return j/m},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.cumulativeReturn=function(b){a.assertPositiveNumberArray_(b);var c=NaN;return b.length>=2&&(c=(b[b.length-1]-b[0])/b[0]),c},a.cagr=function(b,c){function d(a){var b=new Date(a);return b.setMinutes(b.getMinutes()-b.getTimezoneOffset()),b}a.assertPositiveNumberArray_(b),a.assertDateArray_(c),a.assertSameLengthArrays_(b,c);var e=b[0],f=c[0],g=b[b.length-1],h=c[c.length-1],i=864e5,j=(d(h)-d(f))/i,k=j/365.25,l=Math.pow(g/e,1/k)-1;return l},a.arithmeticReturns=function(b){a.assertPositiveNumberArray_(b);var c=new b.constructor(b.length);c[0]=NaN;for(var d=1;d<b.length;++d)c[d]=(b[d]-b[d-1])/b[d-1];return c},a.valueAtRisk=function(b,c){a.assertBoundedNumber_(c,0,1);var d=a.arithmeticReturns(b).slice(1);return d.sort(function(a,b){return a-b}),w=Math.floor(c*d.length),0==w?NaN:(valAtRisk=-d[w-1],valAtRisk)},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){function b(a,b){var c=1.11e-16,d=26.543,e=[3.1611237438705655,113.86415415105016,377.485237685302,3209.3775891384694,.18577770618460315],f=[23.601290952344122,244.02463793444417,1282.6165260773723,2844.236833439171],g=[.5641884969886701,8.883149794388377,66.11919063714163,298.6351381974001,881.952221241769,1712.0476126340707,2051.0783778260716,1230.3393547979972,2.1531153547440383e-8],h=[15.744926110709835,117.6939508913125,537.1811018620099,1621.3895745666903,3290.7992357334597,4362.619090143247,3439.3676741437216,1230.3393548037495],i=[.30532663496123236,.36034489994980445,.12578172611122926,.016083785148742275,.0006587491615298378,.016315387137302097],j=[2.568520192289822,1.8729528499234604,.5279051029514285,.06051834131244132,.0023352049762686918],k=Math.abs(a);if(k<=.46875){var l=0;k>=c&&(l=k*k);var m=a*((((e[4]*l+e[0])*l+e[1])*l+e[2])*l+e[3])/((((l+f[0])*l+f[1])*l+f[2])*l+f[3]);return 1===b&&(m=1-m),m}if(k<=4){var m=((((((((g[8]*k+g[0])*k+g[1])*k+g[2])*k+g[3])*k+g[4])*k+g[5])*k+g[6])*k+g[7])/((((((((k+h[0])*k+h[1])*k+h[2])*k+h[3])*k+h[4])*k+h[5])*k+h[6])*k+h[7]),l=16*k;l=(l>=0?Math.floor(l):Math.ceil(l))/16;var n=(k-l)*(k+l);m=Math.exp(-l*l)*Math.exp(-n)*m}else if(k>4){var m=0;if(k<d){var l=1/(k*k);m=l*(((((i[5]*l+i[0])*l+i[1])*l+i[2])*l+i[3])*l+i[4])/(((((l+j[0])*l+j[1])*l+j[2])*l+j[3])*l+j[4]),m=(.5641895835477563-m)/k;var l=16*k;l=(l>=0?Math.floor(l):Math.ceil(l))/16;var n=(k-l)*(k+l);m=Math.exp(-l*l)*Math.exp(-n)*m}}return 0===b?(m=.5-m+.5,a<=0&&(m=-m)):1===b&&a<=0&&(m=2-m),m}return a.normsinv_=function(b,c){void 0===c&&(c=!1);var d=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],e=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],f=[-.007784894002430293,-.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783],g=[.007784695709041462,.3224671290700398,2.445134137142996,3.754408661907416],h=.02425,i=1-h,j=NaN;if(0==b)j=Number.NEGATIVE_INFINITY;else if(1==b)j=Number.POSITIVE_INFINITY;else if(b<h){var k=Math.sqrt(-2*Math.log(b));j=(((((f[0]*k+f[1])*k+f[2])*k+f[3])*k+f[4])*k+f[5])/((((g[0]*k+g[1])*k+g[2])*k+g[3])*k+1)}else if(b>i){var k=Math.sqrt(-2*Math.log(1-b));j=-(((((f[0]*k+f[1])*k+f[2])*k+f[3])*k+f[4])*k+f[5])/((((g[0]*k+g[1])*k+g[2])*k+g[3])*k+1)}else if(h<=b&&b<=i){var k=b-.5,l=k*k;j=(((((d[0]*l+d[1])*l+d[2])*l+d[3])*l+d[4])*l+d[5])*k/(((((e[0]*l+e[1])*l+e[2])*l+e[3])*l+e[4])*l+1)}if(c===!0){var m=.5*a.erfc_(-j/1.4142135623730951)-b,n=2.5066282746310002*m*Math.exp(j*j/2);j-=n/(1+j*n/2)}return j},a.erf_=function(a){return b(a,0)},a.erfc_=function(a){return b(a,1)},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.hpm_=function(a,b,c){for(var d=a.length,e=0,f=0,g=0;g<d;++g)f+=Math.pow(Math.max(0,a[g]-c),b);e=f/d;for(var h=0,g=0;g<d;++g)h+=Math.pow(Math.max(0,a[g]-c),b)-e;return(f+h)/d},a.lpm_=function(a,b,c){for(var d=a.length,e=0,f=0,g=0;g<d;++g)f+=Math.pow(Math.max(0,c-a[g]),b);e=f/d;for(var h=0,g=0;g<d;++g)h+=Math.pow(Math.max(0,c-a[g]),b)-e;return(f+h)/d},a.mean_=function(a){for(var b=a.length,c=0,d=0,e=0;e<b;++e)d+=a[e];c=d/b;for(var f=0,e=0;e<b;++e)f+=a[e]-c;return(d+f)/b},a.variance_=function(b){if(1==b.length)return NaN;for(var c=b.length,d=a.mean_(b),e=0,f=0,g=0;g<c;++g){var h=b[g]-d;e+=h*h,f+=h}var i=e-f*f/c;return i/c},a.sampleVariance_=function(b){var c=a.variance_(b),d=b.length;return c*d/(d-1)},a.stddev_=function(b){return Math.sqrt(a.variance_(b))},a.sampleStddev_=function(b){return Math.sqrt(a.sampleVariance_(b))},a.skewness_=function(b){if(b.length<=2)return NaN;for(var c=b.length,d=a.mean_(b),e=0,f=0,g=0,h=0;h<c;++h){var i=b[h]-d,j=i*i;e+=i*j,f+=j,g+=i}var k=g*g,l=e-2*g*f/c+2*k*g/(c*c),m=(f-k/c)/c;return 0==m?NaN:l/(c*Math.sqrt(m)*m)},a.sampleSkewness_=function(b){var c=a.skewness_(b),d=b.length;return c*Math.sqrt(d*(d-1))/(d-2)},a.kurtosis_=function(b){if(b.length<=3)return NaN;for(var c=b.length,d=a.mean_(b),e=0,f=0,g=0,h=0,i=0;i<c;++i){var j=b[i]-d,k=j*j;e+=k*k,f+=j*k,g+=k,h+=j}var l=c*c,m=h*h,n=e-4*h*f/c+6*m*g/l-3*m*m/(l*c),o=(g-m/c)/c;return 0==o?NaN:n/(c*o*o)},a.sampleKurtosis_=function(b){var c=a.kurtosis_(b),d=b.length;return(d-1)/((d-2)*(d-3))*((d+1)*c-3*(d-1))+3},a}(PortfolioAnalytics||{});var PortfolioAnalytics=PortfolioAnalytics||{};PortfolioAnalytics=function(a){return a.assertArray_=function(a){if(Object.prototype.toString.call(a).indexOf("Array")==-1)throw new Error("input must be an array")},a.assertNumberArray_=function(b){try{a.assertArray_(b)}catch(c){throw new Error("input must be an array of numbers")}if(0==b.length)throw new Error("input must be an array of numbers");for(var d=0;d<b.length;++d)try{a.assertNumber_(b[d])}catch(c){throw new Error("input must be an array of numbers")}},a.assertPositiveNumberArray_=function(b){try{a.assertArray_(b)}catch(c){throw new Error("input must be an array of positive numbers")}if(0==b.length)throw new Error("input must be an array of positive numbers");for(var d=0;d<b.length;++d)try{a.assertPositiveNumber_(b[d])}catch(c){throw new Error("input must be an array of positive numbers")}},a.assertNumber_=function(a){if("[object Number]"!=Object.prototype.toString.call(a)||isNaN(a)||a===1/0||a===-(1/0))throw new Error("input must be a number")},a.assertPositiveNumber_=function(b){try{a.assertNumber_(b)}catch(c){throw new Error("input must be a positive number")}if(b<0)throw new Error("input must be a positive number")},a.assertBoundedNumber_=function(b,c,d){try{a.assertNumber_(b),a.assertNumber_(c),a.assertNumber_(d)}catch(e){throw new Error("input(s) must be a number")}if(b<c||b>d)throw new Error("input must be bounded between "+c+" and "+d)},a.assertPositiveInteger_=function(b){try{a.assertPositiveNumber_(b)}catch(c){throw new Error("input must be a positive integer")}if(Math.floor(b)!==b)throw new Error("input must be a positive integer")},a.assertString_=function(a){if(!("string"==typeof a||a instanceof String))throw new Error("input must be a string")},a.assertStringEnumeration_=function(b,c){try{a.assertArray_(c)}catch(d){throw new Error("input must be an array of strings")}for(var e=0;e<c.length;++e)try{a.assertString_(c[e])}catch(d){throw new Error("input must be an array of strings")}try{a.assertString_(b)}catch(d){throw new Error("input must be a string equals to any of "+c.toString())}if(c.indexOf(b)==-1)throw new Error("input must be a string equals to any of "+c.toString())},a.assertDate_=function(a){if(!(a instanceof Date)||isNaN(a.getTime()))throw new Error("input must be a date")},a.assertDateArray_=function(b){try{a.assertArray_(b)}catch(c){throw new Error("input must be an array of dates")}if(0==b.length)throw new Error("input must be an array of dates");for(var d=0;d<b.length;++d)try{a.assertDate_(b[d])}catch(c){throw new Error("input must be an array of dates")}},a.assertSameLengthArrays_=function(b,c){try{a.assertArray_(b),a.assertArray_(c)}catch(d){throw new Error("input must be arrays of same length")}if(b.length!=c.length)throw new Error("input must be arrays of same length")},a}(PortfolioAnalytics||{});